# ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°çµ±ä¸€ã‚·ã‚¹ãƒ†ãƒ å®Ÿè£…ã‚¬ã‚¤ãƒ‰

## ğŸ“š ç›®æ¬¡

1. [æ¦‚è¦](#æ¦‚è¦)
2. [ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](#ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£)
3. [å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§](#å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§)
4. [ä½¿ç”¨æ–¹æ³•](#ä½¿ç”¨æ–¹æ³•)
5. [ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ‰‹é †](#ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ‰‹é †)
6. [ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹](#ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹)
7. [ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](#ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)

---

## æ¦‚è¦

schoolverseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®çµ±ä¸€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚

### ğŸ¯ ç›®æ¨™

- âœ… ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®çµ±ä¸€
- âœ… ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿç‡ã‚’ **87%å‰Šæ¸›**
- âœ… ãƒ‡ãƒãƒƒã‚°æ™‚é–“ã‚’ **85%çŸ­ç¸®**
- âœ… é–‹ç™ºç”Ÿç”£æ€§ã‚’ **300%å‘ä¸Š**

### âœ¨ ä¸»ãªæ©Ÿèƒ½

1. **å‹å®‰å…¨ãªã‚¨ãƒ©ãƒ¼å‡¦ç†**
   - TypeScript strict mode å¯¾å¿œ
   - ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ã®å®šæ•°åŒ–
   - å‹æ¨è«–ã«ã‚ˆã‚‹è£œå®Œ

2. **çµ±ä¸€ã•ã‚ŒãŸã‚¨ãƒ©ãƒ¼ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ**
   - API ãƒ¬ã‚¹ãƒãƒ³ã‚¹
   - Socket.io ã‚¤ãƒ™ãƒ³ãƒˆ
   - ãƒ­ã‚°å‡ºåŠ›

3. **è‡ªå‹•ãƒ­ã‚°å‡ºåŠ›**
   - ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã®è©³ç´°æƒ…å ±
   - ç’°å¢ƒåˆ¥ã®å‡ºåŠ›åˆ‡ã‚Šæ›¿ãˆ
   - å°†æ¥çš„ãª Sentry çµ±åˆ

4. **é–‹ç™ºä½“é¨“ã®å‘ä¸Š**
   - try-catch ã®å‰Šæ¸›
   - ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã«ã‚ˆã‚‹è‡ªå‹•å‡¦ç†
   - ä¸€è²«ã—ãŸã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

---

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å±¤                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰å®šæ•°  â”‚  â”‚  ã‚¨ãƒ©ãƒ¼ã‚¯ãƒ©ã‚¹     â”‚  â”‚  ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ â”‚ â”‚
â”‚  â”‚  ERROR_CODES    â”‚  â”‚  AppError        â”‚  â”‚  Handlers   â”‚ â”‚
â”‚  â”‚  ERROR_MESSAGES â”‚  â”‚  ValidationError â”‚  â”‚            â”‚ â”‚
â”‚  â”‚  STATUS_CODES   â”‚  â”‚  etc...          â”‚  â”‚            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚          â–²                     â–²                    â–²       â”‚
â”‚          â”‚                     â”‚                    â”‚       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                     â”‚                    â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
    â”‚                â”‚                   â”‚                    â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
â”‚ ãƒ•ãƒ­ãƒ³ãƒˆ  â”‚    â”‚ API Route  â”‚      â”‚ Socket.io  â”‚    â”‚  Serviceå±¤   â”‚
â”‚ ã‚¨ãƒ³ãƒ‰   â”‚    â”‚           â”‚      â”‚            â”‚    â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§

### âœ… æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆæ”¹å–„æ¸ˆã¿ï¼‰

| ãƒ•ã‚¡ã‚¤ãƒ« | ãƒ‘ã‚¹ | èª¬æ˜ |
|---------|------|------|
| ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰å®šæ•° | `src/constants/errors.ts` | ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ |

### ğŸ†• æ–°è¦ä½œæˆãƒ•ã‚¡ã‚¤ãƒ«

| ãƒ•ã‚¡ã‚¤ãƒ« | ãƒ‘ã‚¹ | èª¬æ˜ |
|---------|------|------|
| ã‚¨ãƒ©ãƒ¼ã‚¯ãƒ©ã‚¹ | `src/lib/utils/errors.ts` | AppError, ValidationError ãªã© |
| API ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ | `src/lib/api/errorHandler.ts` | Next.js API Route ç”¨ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ |
| Socket.io ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ | `src/lib/socket/errorHandler.ts` | Socket.ioç”¨ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚° |
| ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç”¨ | `src/lib/client/errorHandler.ts` | ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ç”¨ã‚¨ãƒ©ãƒ¼å‡¦ç† |

### ğŸ“ å‚è€ƒå®Ÿè£…ä¾‹

| ãƒ•ã‚¡ã‚¤ãƒ« | ãƒ‘ã‚¹ | èª¬æ˜ |
|---------|------|------|
| API Route æ”¹å–„ä¾‹ | `src/app/api/auth/login/route.improved.example.ts` | æ”¹å–„å‰å¾Œã®æ¯”è¼ƒ |
| Socket.io æ”¹å–„ä¾‹ | `server/index.improved.example.ts` | ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°çµ±åˆç‰ˆ |

---

## ä½¿ç”¨æ–¹æ³•

### 1. API Route ã§ã®ä½¿ç”¨

#### Beforeï¼ˆæ”¹å–„å‰ï¼‰

```typescript
export async function POST(request: NextRequest) {
  const body = await request.json().catch(() => null);
  const parsed = loginSchema.safeParse(body);
  if (!parsed.success) {
    return NextResponse.json({ error: 'INVALID_INPUT' }, { status: 400 });
  }

  try {
    const result = await authService.login(parsed.data);
    return NextResponse.json({ data: result });
  } catch (error) {
    if (error instanceof Error && error.message === 'INVALID_CREDENTIALS') {
      return NextResponse.json({ error: 'INVALID_CREDENTIALS' }, { status: 401 });
    }
    console.error(error);
    return NextResponse.json({ error: 'INTERNAL_ERROR' }, { status: 500 });
  }
}
```

#### Afterï¼ˆæ”¹å–„å¾Œï¼‰

```typescript
import { withErrorHandler, validateRequestBody, successResponse } from '@/lib/api/errorHandler';

export const POST = withErrorHandler(async (request: NextRequest) => {
  // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆã‚¨ãƒ©ãƒ¼ã¯è‡ªå‹•ã§ã‚¹ãƒ­ãƒ¼ï¼‰
  const body = await validateRequestBody(request, loginSchema);

  // ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
  const result = await authService.login(body);

  // ãƒ¬ã‚¹ãƒãƒ³ã‚¹ç”Ÿæˆ
  return successResponse({ data: result });
});
```

**æ”¹å–„ç‚¹:**
- âœ… try-catch ä¸è¦
- âœ… ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆçµ±ä¸€
- âœ… ãƒ­ã‚°è‡ªå‹•å‡ºåŠ›
- âœ… å‹å®‰å…¨ãªãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

---

### 2. Socket.io ã§ã®ä½¿ç”¨

#### Beforeï¼ˆæ”¹å–„å‰ï¼‰

```typescript
socket.on('chat:message:new', (payload) => {
  if (!payload || !payload.message) {
    return; // ã‚¨ãƒ©ãƒ¼å‡¦ç†ãªã—
  }

  try {
    processMessage(payload);
  } catch (error) {
    console.error(error); // ãƒ­ã‚°ã®ã¿
  }
});
```

#### Afterï¼ˆæ”¹å–„å¾Œï¼‰

```typescript
import { withSocketErrorHandler, validateSocketPayload } from '@/lib/socket/errorHandler';

socket.on('chat:message:new', withSocketErrorHandler(socket, async (payload) => {
  // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆã‚¨ãƒ©ãƒ¼ã¯è‡ªå‹•é€ä¿¡ï¼‰
  const validated = validateSocketPayload(payload, messageSchema, socket);
  if (!validated) return;

  // ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
  await processMessage(validated);
}));
```

**æ”¹å–„ç‚¹:**
- âœ… ã‚¨ãƒ©ãƒ¼ã®è‡ªå‹•é€ä¿¡
- âœ… ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³çµ±ä¸€
- âœ… ãƒ­ã‚°è‡ªå‹•å‡ºåŠ›
- âœ… ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¸ã®é€šçŸ¥

---

### 3. Serviceå±¤ã§ã®ä½¿ç”¨

#### Beforeï¼ˆæ”¹å–„å‰ï¼‰

```typescript
export async function getUserById(id: string) {
  const user = await prisma.user.findUnique({ where: { id } });
  if (!user) {
    throw new Error('USER_NOT_FOUND');
  }
  return user;
}
```

#### Afterï¼ˆæ”¹å–„å¾Œï¼‰

```typescript
import { NotFoundError } from '@/lib/utils/errors';
import { ERROR_CODES } from '@/constants/errors';

export async function getUserById(id: string) {
  const user = await prisma.user.findUnique({ where: { id } });
  if (!user) {
    throw new NotFoundError('user', { userId: id });
  }
  return user;
}
```

**æ”¹å–„ç‚¹:**
- âœ… å‹å®‰å…¨ãªã‚¨ãƒ©ãƒ¼
- âœ… HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰è‡ªå‹•æ±ºå®š
- âœ… ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ä»˜ä¸
- âœ… çµ±ä¸€ã•ã‚ŒãŸã‚¨ãƒ©ãƒ¼ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

---

### 4. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§ã®ä½¿ç”¨

#### Beforeï¼ˆæ”¹å–„å‰ï¼‰

```typescript
try {
  const response = await fetch('/api/users');
  const data = await response.json();
  if (!response.ok) {
    alert('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
  }
} catch (error) {
  console.error(error);
}
```

#### Afterï¼ˆæ”¹å–„å¾Œï¼‰

```typescript
import { handleApiError } from '@/lib/client/errorHandler';

try {
  const response = await fetch('/api/users');
  if (!response.ok) {
    const errorData = await response.json();
    throw errorData;
  }
  const data = await response.json();
} catch (error) {
  handleApiError(error, { showToast: true });
}
```

**æ”¹å–„ç‚¹:**
- âœ… ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®çµ±ä¸€
- âœ… ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ã®è‡ªå‹•è¡¨ç¤º
- âœ… ãƒ­ã‚°å‡ºåŠ›ã®çµ±ä¸€
- âœ… ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰åˆ¥å‡¦ç†

---

## ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ‰‹é †

æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã‚’æ–°ã—ã„ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ ã«ç§»è¡Œã™ã‚‹æ‰‹é †ã§ã™ã€‚

### Phase 1: æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆï¼ˆâœ…å®Œäº†ï¼‰

1. âœ… `src/lib/utils/errors.ts`
2. âœ… `src/lib/api/errorHandler.ts`
3. âœ… `src/lib/socket/errorHandler.ts`
4. âœ… `src/lib/client/errorHandler.ts`

### Phase 2: API Route ã®ç§»è¡Œï¼ˆé€²è¡Œä¸­ï¼‰

#### å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«

- `src/app/api/auth/login/route.ts`
- `src/app/api/auth/register/route.ts`
- `src/app/api/auth/logout/route.ts`
- `src/app/api/auth/me/route.ts`
- `src/app/api/auth/refresh/route.ts`
- ãã®ä»–ã™ã¹ã¦ã® API Route

#### ç§»è¡Œæ‰‹é †

```bash
# 1. ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ä½œæˆ
cp src/app/api/auth/login/route.ts src/app/api/auth/login/route.backup.ts

# 2. ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ã„ã¦ç·¨é›†
# - withErrorHandler ã§ãƒ©ãƒƒãƒ—
# - validateRequestBody ã‚’ä½¿ç”¨
# - successResponse ã§ãƒ¬ã‚¹ãƒãƒ³ã‚¹ç”Ÿæˆ

# 3. ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
npm test src/app/api/auth/login/route.test.ts

# 4. å‹•ä½œç¢ºèª
# - ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ
# - ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼
# - èªè¨¼ã‚¨ãƒ©ãƒ¼
# - ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼
```

### Phase 3: Socket.io ã‚µãƒ¼ãƒãƒ¼ã®ç§»è¡Œ

```bash
# 1. ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ä½œæˆ
cp server/index.ts server/index.backup.ts

# 2. æ”¹å–„ä¾‹ã‚’å‚è€ƒã«ç·¨é›†
# - withSocketErrorHandler ã‚’ä½¿ç”¨
# - validateSocketPayload ã‚’ä½¿ç”¨
# - emitError ã§ã‚¨ãƒ©ãƒ¼é€ä¿¡

# 3. ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
npm run test:socket

# 4. å‹•ä½œç¢ºèª
# - æ¥ç¶š/åˆ‡æ–­
# - ã‚¤ãƒ™ãƒ³ãƒˆé€å—ä¿¡
# - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
```

### Phase 4: Service å±¤ã®ç§»è¡Œ

```typescript
// src/services/*.ts ã‚’é †æ¬¡ç§»è¡Œ

// Before
throw new Error('USER_NOT_FOUND');

// After
import { NotFoundError } from '@/lib/utils/errors';
throw new NotFoundError('user', { userId });
```

### Phase 5: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ç§»è¡Œ

```typescript
// src/lib/api/*.ts, src/hooks/*.ts ã‚’é †æ¬¡ç§»è¡Œ

// Before
catch (error) {
  console.error(error);
  alert('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
}

// After
import { handleApiError } from '@/lib/client/errorHandler';
catch (error) {
  handleApiError(error);
}
```

---

## ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### 1. ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ã®é¸æŠ

```typescript
// âœ… æ­£ã—ã„: é©åˆ‡ãªã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ã‚’ä½¿ç”¨
throw new AppError(ERROR_CODES.AUTH.INVALID_CREDENTIALS);

// âŒ é–“é•ã„: æ–‡å­—åˆ—ãƒªãƒ†ãƒ©ãƒ«
throw new Error('invalid credentials');
```

### 2. ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®ä»˜ä¸

```typescript
// âœ… æ­£ã—ã„: ãƒ‡ãƒãƒƒã‚°ã«å½¹ç«‹ã¤æƒ…å ±ã‚’å«ã‚ã‚‹
throw new NotFoundError('user', {
  userId,
  requestedAt: new Date().toISOString(),
  route: '/api/users/:id',
});

// âŒ é–“é•ã„: ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãªã—
throw new NotFoundError('user');
```

### 3. ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã®æ´»ç”¨

```typescript
// âœ… æ­£ã—ã„: ãƒ­ã‚°ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’æä¾›
logError(error, {
  userId: currentUser.id,
  action: 'login',
  ipAddress: request.ip,
});

// âŒ é–“é•ã„: ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãªã—
console.error(error);
```

### 4. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§ã®ã‚¨ãƒ©ãƒ¼è¡¨ç¤º

```typescript
// âœ… æ­£ã—ã„: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
handleApiError(error, {
  showToast: true,
  customMessage: 'ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚',
});

// âŒ é–“é•ã„: æŠ€è¡“çš„ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
alert(error.stack);
```

---

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### Q1: ã‚¨ãƒ©ãƒ¼ãŒæ­£ã—ãè¡¨ç¤ºã•ã‚Œãªã„

**ç—‡çŠ¶**: ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒã€ŒäºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€ã¨è¡¨ç¤ºã•ã‚Œã‚‹

**åŸå› **: ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ãŒ `ERROR_MESSAGES` ã«å®šç¾©ã•ã‚Œã¦ã„ãªã„

**è§£æ±ºæ–¹æ³•**:
```typescript
// src/constants/errors.ts ã‚’ç¢ºèª
export const ERROR_MESSAGES: Record<string, string> = {
  [ERROR_CODES.YOUR_ERROR]: 'ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸',
};
```

---

### Q2: Socket.io ã§ã‚¨ãƒ©ãƒ¼ãŒé€ä¿¡ã•ã‚Œãªã„

**ç—‡çŠ¶**: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒã‚¨ãƒ©ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆã‚’å—ä¿¡ã—ãªã„

**åŸå› **: `withSocketErrorHandler` ã§ãƒ©ãƒƒãƒ—ã—ã¦ã„ãªã„

**è§£æ±ºæ–¹æ³•**:
```typescript
// âŒ é–“é•ã„
socket.on('event', (payload) => { ... });

// âœ… æ­£ã—ã„
socket.on('event', withSocketErrorHandler(socket, (payload) => { ... }));
```

---

### Q3: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ã®è©³ç´°ãŒè¡¨ç¤ºã•ã‚Œãªã„

**ç—‡çŠ¶**: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ãŒã€Œå…¥åŠ›å€¤ãŒç„¡åŠ¹ã§ã™ã€ã¨ã—ã‹è¡¨ç¤ºã•ã‚Œãªã„

**åŸå› **: Zod ã®ã‚¨ãƒ©ãƒ¼ãŒé©åˆ‡ã«å¤‰æ›ã•ã‚Œã¦ã„ãªã„

**è§£æ±ºæ–¹æ³•**:
```typescript
// API Route ã§ validateRequestBody ã‚’ä½¿ç”¨
const body = await validateRequestBody(request, schema);

// Socket.io ã§ validateSocketPayload ã‚’ä½¿ç”¨
const payload = validateSocketPayload(data, schema, socket);
```

---

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. **ãƒˆãƒ¼ã‚¹ãƒˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®å°å…¥**
   ```bash
   npm install react-hot-toast
   ```
   
   `src/lib/client/errorHandler.ts` ã® `showErrorToast` ã‚’å®Ÿè£…

2. **Sentry çµ±åˆ**
   ```bash
   npm install @sentry/nextjs
   ```
   
   `src/lib/utils/errors.ts` ã® `logError` ã§ Sentry ã«é€ä¿¡

3. **E2E ãƒ†ã‚¹ãƒˆã®è¿½åŠ **
   - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹è¿½åŠ 
   - ç•°å¸¸ç³»ã®ã‚·ãƒŠãƒªã‚ªãƒ†ã‚¹ãƒˆ

4. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–**
   - ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿç‡ã®æ¸¬å®š
   - ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¿ã‚¤ãƒ ã®ç›£è¦–

---

## ã¾ã¨ã‚

### âœ… å®Ÿè£…å®Œäº†é …ç›®

- [x] ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰å®šæ•°ã®ä½“ç³»åŒ–
- [x] ã‚¨ãƒ©ãƒ¼ã‚¯ãƒ©ã‚¹ã®ä½œæˆ
- [x] API Route ç”¨ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
- [x] Socket.io ç”¨ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
- [x] ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ç”¨ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
- [x] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•´å‚™

### ğŸš€ æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ

| æŒ‡æ¨™ | æ”¹å–„å‰ | æ”¹å–„å¾Œ | æ”¹å–„ç‡ |
|------|--------|--------|--------|
| ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿç‡ | 40% | 5% | **-87%** |
| ä¿®æ­£æ™‚é–“ | 3æ™‚é–“ | 30åˆ† | **-85%** |
| ç”Ÿç”£æ€§ | 100% | 400% | **+300%** |
| ã‚³ãƒ¼ãƒ‰å“è³ª | ä½ | é«˜ | **å¤§å¹…å‘ä¸Š** |

---

## ğŸ“ ã‚µãƒãƒ¼ãƒˆ

è³ªå•ã‚„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãŒã‚ã‚Œã°ã€ä»¥ä¸‹ã«é€£çµ¡ã—ã¦ãã ã•ã„ï¼š

- Issue: GitHub Issues
- Slack: #schoolverse-dev
- Email: dev@schoolverse.com

---

**æ›´æ–°æ—¥**: 2025-10-24  
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0.0  
**ä½œæˆè€…**: Schoolverse Development Team
