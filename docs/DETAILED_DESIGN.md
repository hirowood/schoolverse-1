# ğŸ—ï¸ EduVerse è©³ç´°è¨­è¨ˆæ›¸ (v2.0 / v2.1.0 æ‹¡å¼µè¨ˆç”»åæ˜ )

**ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 2.1.0  
**æœ€çµ‚æ›´æ–°**: 2025-10-22  
**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚³ãƒ¼ãƒ‰**: schoolverse_1 (EduVerse)  
**å‚ç…§å…ƒ**: `docs/requirements.md`, Phase 1ã€œ4 WBS, v2.0/2.1.0 è¦ä»¶  

---

## ğŸ“‘ ç›®æ¬¡

1. [ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ¦‚è¦](#ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ¦‚è¦)  
2. [ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã¨ã‚¹ã‚³ãƒ¼ãƒ—](#ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã¨ã‚¹ã‚³ãƒ¼ãƒ—)  
3. [å…¨ä½“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](#å…¨ä½“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£)  
4. [ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰è©³ç´°è¨­è¨ˆ](#ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰è©³ç´°è¨­è¨ˆ)  
5. [ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰è©³ç´°è¨­è¨ˆ](#ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰è©³ç´°è¨­è¨ˆ)  
6. [ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ»ãƒ¡ãƒ‡ã‚£ã‚¢å‡¦ç†è¨­è¨ˆ](#ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ¡ãƒ‡ã‚£ã‚¢å‡¦ç†è¨­è¨ˆ)  
7. [ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ](#ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ)  
8. [å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹é€£æºè¨­è¨ˆ](#å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹é€£æºè¨­è¨ˆ)  
9. [WBS/ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—é€£æºè¨­è¨ˆè¦³ç‚¹](#wbsãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—é€£æºè¨­è¨ˆè¦³ç‚¹)  
10. [å“è³ªä¿è¨¼ãƒ»é‹ç”¨è¨­è¨ˆ](#å“è³ªä¿è¨¼é‹ç”¨è¨­è¨ˆ)  

---

## ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ¦‚è¦

- æœ¬æ›¸ã¯ `docs/requirements.md` ã«åŸºã¥ã **v2.0/v2.1.0 æ‹¡å¼µ** ã‚’æƒ³å®šã—ãŸè©³ç´°è¨­è¨ˆæ›¸ã§ã™ã€‚  
- Phase 1ã€œ4 ã®æ–°æ©Ÿèƒ½ (ãƒ“ãƒ‡ã‚ªä¼šè­°ãƒ»èª²é¡Œ/æ¡ç‚¹ãƒ»å¤šåˆ†é‡ã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ ãƒ»ãƒ‡ã‚¸ã‚¿ãƒ«ãƒãƒ¼ãƒˆ/OCR/AIã‚µãƒãƒ¼ãƒˆ) ã‚’æ®µéšçš„ã«çµ±åˆã™ã‚‹å‰æã§ã€å†åˆ©ç”¨å¯èƒ½ãªãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­è¨ˆã¨ã‚³ãƒ¡ãƒ³ãƒˆæ–¹é‡ã‚’æ˜è¨˜ã—ã¦ã„ã¾ã™ã€‚  
- ã‚³ãƒ¼ãƒ‰å¤‰æ›´æ™‚ã«ã¯ã€æœ¬è¨­è¨ˆæ›¸è©²å½“ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’æ›´æ–°ã—ã€ã‚³ãƒŸãƒƒãƒˆã«è¨­è¨ˆå¤‰æ›´ã®è¦ç´„ã‚’æ·»ãˆã¦ãã ã•ã„ã€‚  

---

## ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã¨ã‚¹ã‚³ãƒ¼ãƒ—

| é …ç›® | å†…å®¹ |
|------|------|
| **ç›®çš„** | é€šå­¦å›°é›£ãªç”Ÿå¾’å‘ã‘ã«ã€3Dä»®æƒ³ç©ºé–“ã§å­¦ç¿’ãƒ»äº¤æµãƒ»è©•ä¾¡ãƒ»ã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ ã‚’æä¾›ã™ã‚‹çµ±åˆãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã€‚ |
| **è§£æ±ºã™ã‚‹èª²é¡Œ (v2.0 è¦æ±‚)** | ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æˆæ¥­ (WebRTC)ã€èª²é¡Œæå‡º/æ¡ç‚¹ã€è‡ªå‹•å­¦ç¿’ãƒ—ãƒ©ãƒ³ã€ãƒ¡ãƒ³ã‚¿ãƒ«ã‚µãƒãƒ¼ãƒˆã€å®Œå…¨ç„¡æ–™é‹ç”¨ã€‚ |
| **æ‹¡å¼µè¨ˆç”» (v2.1.0)** | ãƒ‡ã‚¸ã‚¿ãƒ«ãƒãƒ¼ãƒˆã€OCRã€AIæ€è€ƒæ•´ç†ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã€å­¦ç¿’ã‚µãƒãƒªãƒ¼ç­‰ã€‚ |
| **ãƒªã‚½ãƒ¼ã‚¹åˆ¶ç´„** | Vercel / Render / Supabase / Upstash ç„¡æ–™æ å†…ã€‚ |
| **é–‹ç™ºæœŸé–“** | 2025-10 ã€œ 2026-06 (Phase 5ã¾ã§)ã€‚ |

---

## å…¨ä½“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ (Vercel)            â”‚
â”‚ Next.js 15 / React 19 / TypeScript                â”‚
â”‚ Tailwind + shadcn/ui / Zustand                    â”‚
â”‚ Three.js + React-Three-Fiber (3Dç©ºé–“)             â”‚
â”‚ fabric.js / react-pdf / pdfjs-dist (ãƒãƒ¼ãƒˆæç”»)   â”‚
â”‚ WebRTC (mediasoup-client) / Socket.io-client      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€HTTPS/WSSâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ (Render)              â”‚
â”‚ Node.js 20 / Express 4                             â”‚
â”‚ Socket.io 4 / mediasoup 3                          â”‚
â”‚ Prisma 5 (PostgreSQL)                              â”‚
â”‚ Multer + Sharp (èª²é¡Œãƒ»ç”»åƒ)                        â”‚
â”‚ OpenAI / Google Vision API ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                      â”‚
        â”‚                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å±¤     â”‚   â”‚  ã‚­ãƒ£ãƒƒã‚·ãƒ¥/ã‚­ãƒ¥ãƒ¼ â”‚
â”‚  Supabase PostgreSQLâ”‚   â”‚  Upstash Redis     â”‚
â”‚  ãƒãƒ¼ãƒˆãƒ»èª²é¡Œãƒ»æˆç¸¾ â”‚   â”‚  ã‚»ãƒƒã‚·ãƒ§ãƒ³ / Rate â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸      â”‚   â”‚ å¤–éƒ¨AI Servicesâ”‚
        â”‚ Supabase Storageâ”‚   â”‚ OpenAI / GCV    â”‚
        â”‚ PDF/ç”»åƒ/è¨˜éŒ²   â”‚   â”‚ (OCR/AIè¦ç´„ç­‰)  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ãƒ¬ã‚¤ãƒ¤ãƒªãƒ³ã‚°æ–¹é‡**
- `src/services/**` â€¦ ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ (Auth, Classroom, Assignment, Curriculum, Note, OCR, AI)  
- `src/repositories/**` â€¦ Prisma ã‚¢ã‚¯ã‚»ã‚¹ãƒ©ãƒƒãƒ‘ (Mockable & å†åˆ©ç”¨)  
- `src/lib/**` â€¦ å…±é€šãƒ©ã‚¤ãƒ–ãƒ©ãƒª (auth utils, realtime, webrtc wrappers, validations)  
- `src/app/api/**` â€¦ Next.js Route Handlers, Serviceå‘¼ã³å‡ºã—ã®ã¿ã§è–„ãä¿ã¤  
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¯ `app/(domain)/` & `components/features/` å˜ä½ã§ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åŒ–ã€‚  

---

## ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰è©³ç´°è¨­è¨ˆ

### 4.1 ã‚³ãƒ¼ãƒ‰è¨­è¨ˆåŸå‰‡
- **å†åˆ©ç”¨å¯èƒ½ãªãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åŒ–**: services / repositories / lib å±¤ã‚’æ˜ç¢ºã«åˆ†é›¢ã—ã€ãƒ†ã‚¹ãƒˆå®¹æ˜“æ€§ã¨åˆå¿ƒè€…ãŒè¿½è·¡ã—ã‚„ã™ã„æ§‹é€ ã«ã™ã‚‹ã€‚  
- **ã‚³ãƒ¡ãƒ³ãƒˆæŒ‡é‡**:  
  - ãƒ•ã‚¡ã‚¤ãƒ«å†’é ­ã«è²¬å‹™ã®è¦ç´„ã‚³ãƒ¡ãƒ³ãƒˆ (ä¾‹: `/* AuthService handles signup/login/token refresh */`)  
  - ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰ã« JSDoc (å¼•æ•°ãƒ»æˆ»ã‚Šå€¤ãƒ»å‰¯ä½œç”¨ãƒ»ä¾‹å¤–)  
  - åˆå­¦è€…å‘ã‘ã«é‡è¦ãªæµã‚Œã‚„ API ä»•æ§˜ã¯ `README` ã§ã¯ãªãè©²å½“ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ä»˜è¿‘ã«ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚³ãƒ¡ãƒ³ãƒˆã‚’ç½®ãã€‚  
- **å‹å…±æœ‰**: `src/types/**` ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚„ DTO ã‚’é›†ç´„ (`auth.ts`, `assignment.ts` ç­‰)ã€‚  

### 4.2 Auth Service (Phase1 Hardening)

```
src/services/authService.ts
â”œâ”€ signup(payload: SignupPayload): AuthResult
â”‚  â”œâ”€ userRepository.findByEmail / findByUsername
â”‚  â”œâ”€ hashPasswordã€signAccessToken/RefreshToken
â”‚  â””â”€ sessionRepository.create
â”œâ”€ login(payload: LoginPayload): AuthResult
â”œâ”€ refresh(payload: RefreshPayload): AuthResult
â”œâ”€ logout(userId: string): void
â””â”€ getSafeUser(userId: string): SafeUser
```

- **èªè¨¼å…±é€šå‹**: `src/types/auth.ts` ã«ã¾ã¨ã‚ã€API routes / hooks / tests ã§å…±é€šåˆ©ç”¨ã€‚  
- **ã‚³ãƒ¡ãƒ³ãƒˆä¾‹**: `AuthService` å†’é ­ã«ã€ŒJWT + httpOnly Cookie ã‚’ä½¿ç”¨ã—ã€ãƒ•ãƒ­ãƒ³ãƒˆã¯ cookie-include fetch ã§é€£æºã€ã¨æ˜è¨˜ã€‚  

### 4.3 èª²é¡Œãƒ»æ¡ç‚¹ (Phase 3)

```
src/services/assignmentService.ts (æ–°è¦)
â”œâ”€ createAssignment(dto)
â”œâ”€ submitAssignment(dto) â†’ Storage + DB
â”œâ”€ autoGrade(assignmentId) â†’ AI APIé€£æº
â”œâ”€ teacherReview(assignmentId, rubric)
â””â”€ fetchResults(studentId)

src/repositories/assignmentRepository.ts
â”œâ”€ create / update / findById
â”œâ”€ submissions.byAssignment / byStudent
â””â”€ gradingRecords
```

- **Storage**: Supabase Storage (éšå±¤: `/assignments/{assignmentId}/{submissionId}/original.pdf`)  
- **ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿**: DB ãƒ†ãƒ¼ãƒ–ãƒ« `Assignment`, `Submission`, `Grading` (è©³ç´°ã¯ [ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ](#ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ) ã‚’å‚ç…§)  
- **AIæ¡ç‚¹**: `src/services/gradingAiService.ts` ã§ OpenAI ãªã©ã¨é€£æºã€‚JSDoc ã§ API ã®å‘¼ã³å‡ºã—ä¾‹ã‚’ã‚³ãƒ¡ãƒ³ãƒˆã€‚  

### 4.4 ã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ  (Phase 4)

```
src/services/curriculumService.ts
â”œâ”€ listDomains() / listUnits(domainId)
â”œâ”€ getContent(contentId)
â”œâ”€ trackProgress(studentId, unitId, status)
â”œâ”€ recommendNext(studentId) â†’ DataTeamã‚¢ãƒ«ã‚´
â””â”€ uploadContent(metadata, file)
```

- **Content Pipeline**: Content JSON (å­¦å¹´/ã‚«ãƒ†ã‚´ãƒª/é›£æ˜“åº¦) + ãƒ•ã‚¡ã‚¤ãƒ« (å‹•ç”»/PDF etc)  
- **ãƒ¬ã‚³ãƒ¡ãƒ³ãƒ‰**: DataTeam æä¾›ã® `ProgressEvaluator` (åˆ¥ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«) ã‚’ä¾å­˜æ³¨å…¥ã€‚  
- **ã‚³ãƒ¡ãƒ³ãƒˆ**: é›£ã—ã„ãƒ­ã‚¸ãƒƒã‚¯ã¯ `/** ãƒ¬ã‚³ãƒ¡ãƒ³ãƒ‰ã‚¢ãƒ«ã‚´æ¦‚è¦: ... */` ã¨èª¬æ˜ã‚’åŠ ãˆã‚‹ã€‚  

### 4.5 ãƒãƒ¼ãƒˆ / OCR / AI (Phase 3.5 & 4.5)

```
src/services/noteService.ts
â”œâ”€ createNotebook(metadata)
â”œâ”€ savePage(noteId, pageId, vectorData) // fabric.js JSON
â”œâ”€ annotatePdf(noteId, pdfAssetId, annotationLayer)
â””â”€ shareNote (classmates, teacher)

src/services/ocrService.ts
â”œâ”€ extractText(imageBinary, { mode }) // Google Vision / tesseract
â””â”€ postProcessText (layout, formatting)

src/services/aiAssistantService.ts
â”œâ”€ summarizeNotes(noteIds, level) // GPT-4o
â”œâ”€ generateMindmap(noteIds or text)
â””â”€ suggestStudyPlan(studentId)
```

- **Plan**: Phase 3.5 ã§ãƒãƒ¼ãƒˆä¿å­˜åŸºç›¤ + OCR PoCã€Phase 4.5 ã§AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆçµ±åˆã€‚  
- **ã‚³ãƒ¡ãƒ³ãƒˆ**: APIé€£æºéƒ¨ã«ã¯ Rate Limit ã‚„ API Key å–å¾—æ–¹æ³•ã‚’è¨˜è¿°ã€‚  

### 4.6 ã‚¬ãƒ¼ãƒ‰ãƒ¬ãƒ¼ãƒ«
- ä¾‹å¤–å®šç¾©: `src/lib/errors.ts` (DomainError, ValidationError ãªã©) ã‚’å…±é€šåŒ–ã—ã€API routes ã§ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã€‚  
- ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³: `src/lib/utils/validators.ts` ã« zod ã‚¹ã‚­ãƒ¼ãƒã‚’æ•´ç†ã€‚  

---

## ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰è©³ç´°è¨­è¨ˆ

### 5.1 ãƒšãƒ¼ã‚¸æ§‹é€ 

```
src/app
â”œâ”€ (auth)/{login,register}/page.tsx
â”œâ”€ (virtual-space)/classroom/page.tsx
â”œâ”€ (dashboard)/student/page.tsx
â”œâ”€ (dashboard)/teacher/page.tsx
â”œâ”€ notebooks/[noteId]/page.tsx            (Phase 3.5)
â”œâ”€ assignments/[id]/page.tsx              (Phase 3)
â”œâ”€ curriculum/[domain]/[unit]/page.tsx    (Phase 4)
â””â”€ meetings/[meetingId]/page.tsx          (Phase 2)
```

### 5.2 çŠ¶æ…‹ç®¡ç† (Zustand)
- `src/store/authStore.ts` (DEPRECATED: NextAuthã«ç§»è¡Œæ¸ˆã¿): cookie ãƒ™ãƒ¼ã‚¹ã®ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã€‚`login/signup/fetchMe/logout` ã¯ã‚³ãƒ¡ãƒ³ãƒˆä»˜ãã§èª¬æ˜æ¸ˆã¿ã€‚  
- æ–°è¦ã‚¹ãƒˆã‚¢:
  - `noteStore.ts`: ç¾åœ¨é–‹ã„ã¦ã„ã‚‹ãƒãƒ¼ãƒˆã®ãƒšãƒ¼ã‚¸ï¼†ãƒ¬ã‚¤ãƒ¤ãƒ¼çŠ¶æ…‹ã€‚  
  - `assignmentStore.ts`: èª²é¡Œä¸€è¦§ãƒ»ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã€‚  
  - `meetingStore.ts`: WebRTC æ¥ç¶šçŠ¶æ…‹ (muted, videoEnabled ç­‰)ã€‚  
- å„ã‚¹ãƒˆã‚¢ã« `/** Summary */` ã‚³ãƒ¡ãƒ³ãƒˆã¨ `set`, `selectors` ã®èª¬æ˜ã‚’å…¥ã‚Œã‚‹ã€‚  

### 5.3 UI ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- `components/features/notes/*`: Canvas (fabric.js) ãƒ©ãƒƒãƒ—ã€ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ã€‚  
- `components/features/assignments/*`: æå‡ºãƒ•ã‚©ãƒ¼ãƒ ã€æ¡ç‚¹ãƒ“ãƒ¥ãƒ¼ã€‚  
- `components/features/meetings/*`: ãƒ¡ãƒ‡ã‚£ã‚¢ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã€å‚åŠ è€…ãƒªã‚¹ãƒˆã€‚  
- `components/features/curriculum/*`: ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚«ãƒ¼ãƒ‰ã€é€²æ—ãƒãƒ£ãƒ¼ãƒˆã€‚  
- å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†’é ­ã§ã€Œå½¹å‰² + ä¸»è¦Propsã€ã‚’ã‚³ãƒ¡ãƒ³ãƒˆã€‚  

### 5.4 å†åˆ©ç”¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
- `hooks/useAuthBootstrap` (ã™ã§ã«å°å…¥) â†’ ã‚³ãƒ¡ãƒ³ãƒˆã§å½¹å‰²æ˜è¨˜ã€‚  
- `hooks/useRealtimeCanvas`, `hooks/useMeetingRoom` â€¦ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ çŠ¶æ…‹ã‚’çµ±ä¸€ã—ã€åˆå¿ƒè€…ã§ã‚‚è¿½ãˆã‚‹ã‚ˆã† `useEffect` ãƒ­ã‚¸ãƒƒã‚¯ã«ã‚³ãƒ¡ãƒ³ãƒˆã€‚  
- `lib/api/client.ts` â€¦ fetch wrapper, CSRF/cookie è¨­å®šã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚³ãƒ¡ãƒ³ãƒˆä»˜ä¸ã€‚  

---

## ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ»ãƒ¡ãƒ‡ã‚£ã‚¢å‡¦ç†è¨­è¨ˆ

### 6.1 Socket.io
- `server/index.ts` (TypeScriptåŒ–æ¸ˆã¿)  
  - ã‚¤ãƒ™ãƒ³ãƒˆ: `presence:*`, `space:position:update`, `chat:*`, è¿½åŠ ã§ `meeting:join/leave`, `note:collab`.  
  - `SOCKET_EVENTS` å®šæ•°ã« JSDoc è¿½åŠ ã—ã€ã‚¤ãƒ™ãƒ³ãƒˆç”¨é€”ã‚’è¨˜è¼‰ã€‚  
- WebRTC:
  - Phase 2: mediasoup SFU on Render (ã‚µãƒ¼ãƒãƒ¼å´ `mediasoupService.ts`)  
  - `MeetingService`: joinRoom â†’ createTransport â†’ produce/consume â†’ leave  
- P2P è¿‘æ¥éŸ³å£°: æ—¢å­˜ P2P ã®ã¾ã¾ (Phase 2 ã‹ã‚‰ SFU ã¸æ¼¸é€²çš„ç§»è¡Œ)  
- ã‚³ãƒ¡ãƒ³ãƒˆ: æ¥ç¶š/åˆ‡æ–­ã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã¨ fallback (P2P -> SFU) ã‚’ã‚³ãƒ¼ãƒ‰å†…ã«èª¬æ˜ã€‚  

### 6.2 ãƒãƒ¼ãƒˆã‚³ãƒ©ãƒœåŒæœŸ (Phase 3.5)
- `note:page:update` ã‚¤ãƒ™ãƒ³ãƒˆã§ diff (fabric.js JSON) ã‚’é…ä¿¡ã€‚  
- `note:lock` ã§åŒæ™‚ç·¨é›†ã‚’åˆ¶é™ã€‚`note:cursor` ã§ä»–ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½ç½®ã‚’è¡¨ç¤ºã€‚  
- `hooks/useCollaborativeNote` ã«åŒæœŸæ‰‹é †ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¨˜è¿°ã€‚  

---

## ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

### 7.1 ä¸»ãƒ†ãƒ¼ãƒ–ãƒ« (æŠœç²‹)

| ãƒ†ãƒ¼ãƒ–ãƒ« | ä¸»è¦ã‚«ãƒ©ãƒ  | è£œè¶³ |
|----------|------------|------|
| `User` | `username`, `displayName`, `status`, `avatarUrl`, `lastLoginAt` | v2.0ã§æ‹¡å¼µæ¸ˆã¿ |
| `Session` | `refreshToken`, `accessToken`, `expiresAt` | å†ãƒ­ã‚°ã‚¤ãƒ³æ™‚ã«å†åˆ©ç”¨ |
| `Assignment` | `title`, `description`, `dueAt`, `category`, `rubricJson` | Rubric JSON ã¯ frontend ã§ã‚‚å‚ç…§ |
| `Submission` | `assignmentId`, `studentId`, `assetPath`, `autoScore`, `teacherScore` | `assetPath` ã¯ Supabase Storage |
| `Notebook` | `title`, `ownerId`, `sharedWith`, `tags` | sharedWith ã¯ JSON é…åˆ— |
| `NotebookPage` | `noteId`, `pageNumber`, `vectorJson`, `pdfAssetId` | fabric.js JSON ã‚’ `vectorJson` ã«ä¿å­˜ |
| `OcrJob` | `inputAssetPath`, `status`, `resultText`, `confidence` | OCR å±¥æ­´ |
| `CurriculumUnit` | `domain`, `grade`, `title`, `contentAssetPath`, `metadataJson` | ã‚³ãƒ³ãƒ†ãƒ³ãƒ„æƒ…å ± |
| `Progress` | `studentId`, `unitId`, `status`, `score`, `lastReviewedAt` | ãƒ¬ã‚³ãƒ¡ãƒ³ãƒ‰ã®åŸºç¤ãƒ‡ãƒ¼ã‚¿ |

### 7.2 ãƒ¢ãƒ‡ãƒ«è¿½åŠ æ™‚ã®æŒ‡é‡
- Prisma ãƒ¢ãƒ‡ãƒ«ã«ã‚³ãƒ¡ãƒ³ãƒˆ (`///`) ã‚’ä»˜ä¸ã—ã€ç”¨é€”ã‚’ç¤ºã™ã€‚  
- ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å‘½åä¾‹: `20260201_add_assignment_tables`.  
- è¤‡é›‘ãª JSON ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ (rubricJson ç­‰) ã¯ `src/types/curriculum.ts` ã«å‹å®šç¾©ã—ã¦å…±æœ‰ã€‚  

---

## å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹é€£æºè¨­è¨ˆ

| åŒºåˆ† | ã‚µãƒ¼ãƒ“ã‚¹ | ç”¨é€” | å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ« | ã‚³ãƒ¡ãƒ³ãƒˆæŒ‡é‡ |
|------|----------|------|--------------|--------------|
| AI | OpenAI GPT-4o mini | ãƒãƒ¼ãƒˆè¦ç´„ã€å­¦ç¿’ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã€Mindmap | `lib/ai/openaiClient.ts`, `services/aiAssistantService.ts` | API Rate/Token ã®æ³¨æ„ã‚’ JSDoc ã«æ˜è¨˜ |
| OCR | Google Cloud Vision | æ‰‹æ›¸ã/å°åˆ·æ–‡å­—èªè­˜ | `lib/ocr/visionClient.ts`, `services/ocrService.ts` | å‰å‡¦ç† (ãƒã‚¤ã‚ºé™¤å»ç­‰) ã®èª¬æ˜ã‚³ãƒ¡ãƒ³ãƒˆ |
| æ¡ç‚¹ | OpenAI/Claude (TBD) | è¨˜è¿°å¼æ¡ç‚¹æ”¯æ´ | `services/gradingAiService.ts` | ä¾‹å¤–å‡¦ç†ãƒ»fallback ã‚³ãƒ¡ãƒ³ãƒˆ |
| ãƒ¡ãƒ‡ã‚£ã‚¢ | mediasoup | SFU (20äººãƒ“ãƒ‡ã‚ª) | `services/meetingService.ts` | Transport/Producer/Consumer æµã‚Œ |
| åˆ†æ | MindGarden (å°†æ¥) | æ„Ÿæƒ…ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚° | `services/wellbeingService.ts` (placeholder) | æœªå®Ÿè£…ã¯ TODO ã‚³ãƒ¡ãƒ³ãƒˆ |

ç’°å¢ƒå¤‰æ•°ã¯ `.env.example` ã«è¿½åŠ ã—ã€`README` ã«ã¦ã‚­ãƒ¼å–å¾—æ‰‹é †ã‚’è§£èª¬ã€‚

---

## WBS/ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—é€£æºè¨­è¨ˆè¦³ç‚¹

### 9.1 Phase ã”ã¨ã®æŠ€è¡“å¢ƒç•Œ

| WBS ID | å¯¾å¿œService/Module | èª¬æ˜ |
|--------|-------------------|------|
| 1.1 | `authService`, `authStore`, `requirements.md` | ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¨ã‚³ãƒ¡ãƒ³ãƒˆæ•´å‚™ã«ã‚ˆã‚Šæ•™è‚²ç”¨é€”ã§ã®å¼•ç¶™ãå®¹æ˜“åŒ–ã€‚ |
| 2.1 | `meetingService`, `hooks/useMeetingRoom` | WebRTC + Socket.io é€£æºã€‚ã‚³ãƒ¡ãƒ³ãƒˆã§ P2Pâ†’SFU åˆ‡æ›¿ã‚’è¨˜è¿°ã€‚ |
| 3.1 | `assignmentService`, `assignmentRepository`, `components/features/assignments` | èª²é¡Œç®¡ç†ãƒ•ãƒ­ãƒ¼ã€‚é€ä¿¡/æ¡ç‚¹/é€šçŸ¥ã®ã‚³ãƒ¡ãƒ³ãƒˆå¿…é ˆã€‚ |
| 4.1 | `curriculumService`, `curriculumStore`, `components/features/curriculum` | ã‚³ãƒ³ãƒ†ãƒ³ãƒ„CMS + é€²æ—ãƒ­ã‚¸ãƒƒã‚¯ã€‚ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®æ„å›³ã‚’ã‚³ãƒ¡ãƒ³ãƒˆåŒ–ã€‚ |
| 3.5 | `noteService`, `hooks/useCollaborativeNote`, `components/features/notes` | fabric.js JSON ã¨ Supabase ä¿å­˜ã®èª¬æ˜ã‚’è¨˜è¿°ã€‚ |
| 4.5 | `aiAssistantService`, `ocrService` | å¤–éƒ¨AIé€£æºã€‚APIåˆ¶é™ã¨ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’ã‚³ãƒ¡ãƒ³ãƒˆã§æ¡ˆå†…ã€‚ |

### 9.2 ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—åæ˜ 
- ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—å„ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ã§ã€Œå®Œäº†æ¡ä»¶ = ãƒ†ã‚¹ãƒˆ + ã‚³ãƒ¡ãƒ³ãƒˆ/ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°å®Œäº†ã€ã§ã‚ã‚‹ã“ã¨ã‚’é–‹ç™ºè¦ç´„ã«æ˜è¨˜ã€‚  
- Phase çµ‚äº†æ™‚ã« `docs/DETAILED_DESIGN.md` ãŠã‚ˆã³ `docs/requirements.md` ã‚’æ›´æ–°ã™ã‚‹ã€Œå®šå¸¸ã‚¿ã‚¹ã‚¯ã€ã‚’ WBS ã«è¿½åŠ  (WBS: 0.x ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°)ã€‚  

---

## å“è³ªä¿è¨¼ãƒ»é‹ç”¨è¨­è¨ˆ

| é …ç›® | è¨­è¨ˆå†…å®¹ |
|------|----------|
| **ãƒ†ã‚¹ãƒˆæ–¹é‡** | `tests/unit` (ã‚µãƒ¼ãƒ“ã‚¹/ãƒªãƒã‚¸ãƒˆãƒª), `tests/integration` (API E2E), `tests/e2e` (Playwright)ã€‚ä¸»è¦ã‚±ãƒ¼ã‚¹ã«ã‚³ãƒ¡ãƒ³ãƒˆã§ç›®çš„ã‚’èª¬æ˜ã€‚ |
| **Lint/Format** | ESLint + Prettier + TypeScript strictã€‚CI ã§ `npm run lint && npm run type-check && npm run test`ã€‚ |
| **ãƒ­ã‚°/ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°** | ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰: pino ã§æ§‹é€ åŒ–ãƒ­ã‚°ã€‚Render ã®ãƒ­ã‚° + Supabase logs + Vercel Observability (ç„¡æ–™æ )ã€‚ |
| **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£** | JWT + httpOnly Cookieã€Rate Limit (Redis)ã€ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«ã® MIME ãƒã‚§ãƒƒã‚¯ã€‚ã‚³ãƒ¡ãƒ³ãƒˆã§ç†ç”±ã‚’æ˜è¨˜ã€‚ |
| **ã‚³ãƒ¡ãƒ³ãƒˆè¦ç´„** | - ãƒ•ã‚¡ã‚¤ãƒ«å†’é ­ã«è²¬å‹™ã¨åˆ©ç”¨ä¾‹  
  - è¤‡é›‘ãªãƒ­ã‚¸ãƒƒã‚¯ã¯ 5ã€œ10 è¡Œã§æ¦‚è¦èª¬æ˜  
  - æœªå®Ÿè£…/æ¤œè¨ä¸­ã¯ TODO: (æ‹…å½“è€…/ç›®çš„/æœŸæ—¥) å½¢å¼  
| **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°** | è¨­è¨ˆ/ä»•æ§˜å¤‰æ›´ â†’ `requirements.md` & `DETAILED_DESIGN.md` æ›´æ–°ãŒå¿…é ˆã€‚CI ã§å·®åˆ†ãƒã‚§ãƒƒã‚¯ (å°†æ¥çš„ã«å°å…¥)ã€‚ |

---

## ä»˜éŒ²: ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨ã‚³ãƒ¡ãƒ³ãƒˆä¾‹

### A. AuthService å†’é ­ã‚³ãƒ¡ãƒ³ãƒˆã‚µãƒ³ãƒ—ãƒ«
```ts
/**
 * AuthService
 * -----------
 * - HTTP-only cookies + JWT ã‚’ç”¨ã„ãŸèªè¨¼ãƒ•ãƒ­ãƒ¼ã‚’æä¾›
 * - signup/login/refresh/logout ã‚’çµ±ä¸€çš„ã«ç®¡ç†
 * - Repository å±¤ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ DB å®Ÿè£…ã‚’éš è”½ã—ã€ãƒ†ã‚¹ãƒˆå®¹æ˜“æ€§ã‚’æ‹…ä¿
 */
```

### B. API Route ã‚³ãƒ¡ãƒ³ãƒˆä¾‹ (`src/app/api/auth/login/route.ts`)
```ts
// POST /api/auth/login
// 1. ãƒªã‚¯ã‚¨ã‚¹ãƒˆ JSON (email, password) ã‚’ zod ã§æ¤œè¨¼
// 2. AuthService.login ã§ JWT & ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ç”Ÿæˆ
// 3. httpOnly Cookie ã«ãƒˆãƒ¼ã‚¯ãƒ³ã‚’è¨­å®šã—ã¤ã¤ã€SafeUser ã‚’è¿”ã™
//    â†’ ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¯ cookie: include fetch ã§èªè¨¼çŠ¶æ…‹ã‚’ç¶­æŒã™ã‚‹
```

### C. ãƒ•ãƒ­ãƒ³ãƒˆ Hook ã‚³ãƒ¡ãƒ³ãƒˆä¾‹ (`hooks/useCollaborativeNote.ts`)
```ts
/**
 * useCollaborativeNote
 * - Socket.io ã‚’ç”¨ã„ãŸãƒãƒ¼ãƒˆãƒšãƒ¼ã‚¸åŒæœŸãƒ­ã‚¸ãƒƒã‚¯
 * - fabric.js JSON å·®åˆ†ã‚’é€å—ä¿¡ã—ã€ä»–ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç·¨é›†å†…å®¹ã‚’å³æ™‚åæ˜ 
 * - Lock/Cursor ã‚¤ãƒ™ãƒ³ãƒˆã§ç«¶åˆã‚’ç·©å’Œ (Phase 3.5)
 */
```

---

## ä»Šå¾Œã®æ›´æ–°ã«ã¤ã„ã¦

- Phase 2 (ãƒ“ãƒ‡ã‚ªä¼šè­°) å®Ÿè£…ç€æ‰‹æ™‚ã« WebRTC ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è©³ç´°åŒ–ã—ã€mediasoup ã‚µãƒ¼ãƒãƒ¼æ§‹æˆå›³ã‚’è¿½åŠ ã™ã‚‹ã€‚  
- Phase 3/4 å®Œäº†æ™‚ã«ãƒãƒ¼ãƒˆ/OCR/AI ã‚µãƒ¼ãƒ“ã‚¹ã®ä¾‹å¤–å‡¦ç†ãƒ»ãƒ†ã‚¹ãƒˆæˆ¦ç•¥ã‚’è¿½è¨˜ã€‚  
- Phase 5 ãƒªãƒªãƒ¼ã‚¹å€™è£œæ™‚ã«ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»é …ç›®ãƒ»é‹ç”¨ Runbook ã‚’è¿½è£œã€‚  

---

**ä½œæˆè€…**: Codex (ChatGPT)  
**ãƒ¬ãƒ“ãƒ¥ã‚¢ãƒ¼**: ï¼ˆæœªè¨˜å…¥ï¼‰  

ã“ã®è¨­è¨ˆæ›¸ã‚’åŸºã«ã€ã‚³ãƒŸãƒƒãƒˆæ™‚ã¯ã€Œè©²å½“ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã€ã®æ›´æ–°ã¨ PR ã‚³ãƒ¡ãƒ³ãƒˆã§ã®è¨€åŠã‚’å¾¹åº•ã—ã¦ãã ã•ã„ã€‚  
