/**
 * @file test-runner.md
 * @description ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚¬ã‚¤ãƒ‰
 * @created 2025-10-24
 */

# ğŸ§ª ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚¬ã‚¤ãƒ‰

## ã‚¹ãƒ†ãƒƒãƒ—1: äº‹å‰æº–å‚™

### 1.1 ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ç¢ºèª
```bash
npm install
```

### 1.2 Prismaã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ç”Ÿæˆ
```bash
npm run prisma:generate
```

### 1.3 ç’°å¢ƒå¤‰æ•°ã®ç¢ºèª
ãƒ†ã‚¹ãƒˆã«å¿…è¦ãªç’°å¢ƒå¤‰æ•°ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªï¼š
```bash
# .env.test ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆå­˜åœ¨ã—ãªã„å ´åˆã¯ä½œæˆï¼‰
NODE_ENV=test
DATABASE_URL="postgresql://test:test@localhost:5432/test_db"
```

---

## ã‚¹ãƒ†ãƒƒãƒ—2: ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

### 2.1 å…¨ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ
```bash
npm run test:unit
```

### 2.2 ã‚«ãƒãƒ¬ãƒƒã‚¸ä»˜ãã§ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
```bash
npm run test:coverage
```

### 2.3 Watchãƒ¢ãƒ¼ãƒ‰ã§ãƒ†ã‚¹ãƒˆå®Ÿè¡Œï¼ˆé–‹ç™ºä¸­ï¼‰
```bash
npm run test:watch
```

---

## ã‚¹ãƒ†ãƒƒãƒ—3: ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆã®ç¢ºèª

ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆã¯ `coverage/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç”Ÿæˆã•ã‚Œã¾ã™ã€‚

### 3.1 ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ã‚«ãƒãƒ¬ãƒƒã‚¸ç¢ºèª
ãƒ†ã‚¹ãƒˆå®Ÿè¡Œå¾Œã€ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«è¡¨ç¤ºã•ã‚Œã¾ã™ï¼š

```
---------------------|---------|----------|---------|---------|-------------------
File                 | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s
---------------------|---------|----------|---------|---------|-------------------
All files            |   92.31 |    88.89 |     100 |   92.31 |
 notebooks/route.ts  |   95.00 |    90.00 |     100 |   95.00 | 42-43
 notebooks/[id]/route|   90.00 |    85.00 |     100 |   90.00 | 78-80
---------------------|---------|----------|---------|---------|-------------------
```

### 3.2 HTMLãƒ¬ãƒãƒ¼ãƒˆã®ç¢ºèª
ãƒ–ãƒ©ã‚¦ã‚¶ã§è©³ç´°ãªãƒ¬ãƒãƒ¼ãƒˆã‚’ç¢ºèªï¼š

```bash
# HTMLãƒ¬ãƒãƒ¼ãƒˆã‚’é–‹ãï¼ˆWindowsï¼‰
start coverage/index.html

# HTMLãƒ¬ãƒãƒ¼ãƒˆã‚’é–‹ãï¼ˆMacï¼‰
open coverage/index.html

# HTMLãƒ¬ãƒãƒ¼ãƒˆã‚’é–‹ãï¼ˆLinuxï¼‰
xdg-open coverage/index.html
```

---

## ã‚¹ãƒ†ãƒƒãƒ—4: ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### å•é¡Œ1: ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒè¦‹ã¤ã‹ã‚‰ãªã„
```
Error: Cannot find module '@/lib/auth/middleware'
```

**è§£æ±ºç­–**:
```bash
# TypeScriptã®å‹ãƒã‚§ãƒƒã‚¯
npm run type-check

# node_modules ã‚’å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
rm -rf node_modules package-lock.json
npm install
```

### å•é¡Œ2: ãƒ†ã‚¹ãƒˆãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã™ã‚‹
```
Error: Test timeout of 5000ms exceeded
```

**è§£æ±ºç­–**:
vitest.config.ts ã«ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®šã‚’è¿½åŠ ï¼š
```typescript
export default defineConfig({
  test: {
    testTimeout: 10000, // 10ç§’ã«å»¶é•·
  },
});
```

### å•é¡Œ3: Prismaé–¢é€£ã®ã‚¨ãƒ©ãƒ¼
```
Error: PrismaClient is not configured
```

**è§£æ±ºç­–**:
```bash
# Prismaã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’å†ç”Ÿæˆ
npm run prisma:generate
```

---

## ã‚¹ãƒ†ãƒƒãƒ—5: CI/CDçµ±åˆã®ç¢ºèª

### 5.1 GitHub Actions ã§ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
Pull Request ã‚’ä½œæˆã™ã‚‹ã¨ã€è‡ªå‹•çš„ã«ãƒ†ã‚¹ãƒˆãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚

### 5.2 ãƒ­ãƒ¼ã‚«ãƒ«ã§CIç’°å¢ƒã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
```bash
# 1. ã‚¯ãƒªãƒ¼ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm ci

# 2. Lintãƒã‚§ãƒƒã‚¯
npm run lint

# 3. å‹ãƒã‚§ãƒƒã‚¯
npm run type-check

# 4. ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
npm run test:unit

# 5. ã‚«ãƒãƒ¬ãƒƒã‚¸ç”Ÿæˆ
npm run test:coverage
```

---

## æœŸå¾…ã•ã‚Œã‚‹çµæœ

### âœ… æˆåŠŸæ™‚ã®å‡ºåŠ›ä¾‹

```
 âœ“ tests/integration/api/notebooks/route.test.ts (16) 1234ms
 âœ“ tests/integration/api/notebooks/[id]/route.test.ts (21) 2345ms

 Test Files  2 passed (2)
      Tests  37 passed (37)
   Start at  10:00:00
   Duration  3.58s (transform 123ms, setup 456ms, collect 789ms, tests 2190ms, environment 0ms, prepare 12ms)

---------------------|---------|----------|---------|---------|-------------------
File                 | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s
---------------------|---------|----------|---------|---------|-------------------
All files            |   92.31 |    88.89 |     100 |   92.31 |
 notebooks/route.ts  |   95.00 |    90.00 |     100 |   95.00 | 42-43
 notebooks/[id]/route|   90.00 |    85.00 |     100 |   90.00 | 78-80
---------------------|---------|----------|---------|---------|-------------------
```

---

## ğŸ“Š ã‚«ãƒãƒ¬ãƒƒã‚¸ç›®æ¨™

| ãƒ•ã‚¡ã‚¤ãƒ« | ç›®æ¨™ã‚«ãƒãƒ¬ãƒƒã‚¸ | ç¾çŠ¶ |
|---------|-------------|------|
| route.ts | 90%+ | ğŸ¯ |
| [id]/route.ts | 90%+ | ğŸ¯ |
| noteService.ts | 85%+ | ğŸ¯ |
| errorHandler.ts | 80%+ | ğŸ¯ |

---

**ä½œæˆæ—¥**: 2025-10-24  
**æœ€çµ‚æ›´æ–°**: 2025-10-24
