# AI Insights UI 仕様メモ (差分ハイライト + マインドマップ/アドバイス表示)

## 1. 目的
AI 要約・マインドマップ・学習アドバイス (F064) の UI を詳細化し、デザイン/フロントエンドで共通認識を持つための仕様メモ。既存の `digital-note-ui-prototype.md` を補完する形でドロワー構成・差分ハイライト・ビジュアル指針を整理する。

---

## 2. 情報設置ポイント

| コンポーネント | 配置 | 表示状態 |
|----------------|------|----------|
| AI Insights トリガー | キャンバス右上の「AI」アイコン + ショートカット `Ctrl/Cmd + Shift + A` | クリックでドロワー全体を開閉 |
| タブ切替 | ドロワー上部 (Tabs: Summary / MindMap / Advice) | 初期は Summary アクティブ |
| 差分トグル | Summary タブ上部に `Diff View` トグル + 過去バージョン選択ドロップダウン | 以前保存済み要約が存在する場合のみ |
| 更新タイムスタンプ | ドロワーフッター右側に「Generated 10 min ago」など表示 | SSE 受信完了後更新 |

---

## 3. Summary タブ

### レイアウト
```
┌──────────── AIサマリ ────────────┐
│ [Diff View ◉] [Base: 2025/10/20 12:00]    │
│ ───────────────────────────────────── │
│ 1. ✅ 差分ハイライト段落               │
│ 2. △ 新規追加段落                      │
│ 3. ハイライトなし (既存一致)           │
│                                         │
│ [ノートへ反映]   [コピー]   [再生成]   │
└─────────────────────────────────────┘
```

### 差分ハイライト仕様
- 比較対象: 最新要約と直近保存要約 (`noteSnapshots.summary.latest`)、未保存の場合は UI 上の最終確定版。
- 差分検出: Google Diff-Match-Patch (`diff-match-patch`) を利用し、段落単位で diff。
- 色分け:
  - `追加`: 背景 #DCFCE7、左サイドバーに緑バー。
  - `削除`: 取り消し線 + 背景 #FEE2E2 (Diff View のみ表示、通常表示では非表示)。
  - `更新`: 背景 #FEF3C7 + 右上に `Updated` バッジ。
- スクロール同期: Diff View ON の場合は上下2カラム (旧/新) を同期スクロール。
- 操作:
  - `ノートへ反映`: 選択した段落のみ反映も可能 (チェックボックスで部分選択)。
  - `再生成`: SSE で進行状況を表示 (しずくインジケータ + % 表示)。

### 状態メッセージ
- `生成中`: Skeleton 段落 + プログレスバー。
- `失敗`: 赤バナー「AI応答を取得できませんでした。再試行してください。」 + リトライボタン。
- `ポリシー違反`: 黄バナー「ガイドラインに沿わない内容が検出されました。編集して再度試してください。」

---

## 4. MindMap タブ

### 表示パネル
```
┌───────── ノード設定 ─────────┐ ┌───────── MindMap Canvas ─────────┐
│ [重要度フィルタ] high ◎ medium ○ low ○ │ │  O  中心トピック (level 0)        │
│ [関係タイプ] すべて/原因/結果/関連      │ │   \                                │
│ [検索] input                          │ │    o 子トピック level1             │
│ [ノード詳細]                           │ │     \                              │
│  Title: ...                            │ │      ○ level2                      │
│  Summary: ...                          │ │                                    │
│  Related Resources: … (リンク)         │ │ (react-flow キャンバス、ズーム可)  │
└──────────────────────────┘ └────────────────────────────────┘
```

### ビジュアルガイド
- Node カラー:
  - `high`: #F97316 (温かいオレンジ) / 白テキスト。
  - `medium`: #38BDF8。
  - `low`: #94A3B8。
- Node サイズ: importance に応じて 120px / 100px / 80px。
- Relation Edge:
  - `原因`: 実線 + ► 矢印。
  - `結果`: 点線 + ▸。
  - `関連`: 曲線 + ◦ (無矢印)。
- Hover 時: ノードが拡大 (scale 1.05)、詳細パネルに内容表示。
- フィットボタン: 全体表示に戻すボタンを右上に配置。
- エクスポート: `PNG` / `SVG` / `JSON` で保存。

### マイクロインタラクション
- ドラッグ時はスナップグリッド (40px)。
- Alt + ドラッグで矩形選択（複数ノード選択）。
- ショートカット: `Cmd/Ctrl + F` で検索フィールドフォーカス。

---

## 5. Advice タブ

### カードレイアウト
```
┌──────────────────────────┐
│ Plan (confidence 0.8)     │
│ ・3日サイクルで復習…       │
│ ・試験4日前に模擬試験…     │
│ [学習計画に追加]           │
└──────────────────────────┘
┌──── Tips ────┐ ┌──── Resources ───┐ ┌──── Warmup ───┐
│ ✅ 重要度:高  │ │ 🔗 公式ドキュメント│ │ ❓ 小テスト問A │
│ …              │ │ …                 │ │ …             │
└─────────────┘ └──────────────┘ └────────────┘
```

- Confidence 表記: `confidence >= 0.7` → 緑バッジ、`0.5-0.7` → 黄、`<0.5` → 赤警告アイコン。
- CTA:
  - `学習計画に追加`: クリックで ToDo モーダルへ引き継ぎ（タイトル/期日/メモ自動入力）。
  - `PDFエクスポート`: カード群をまとめて出力。
- エラー/ステート:
  - `データ不足`: 灰色カード「ノート内容が不足しています」で再生成を促す。
  - `レート制限`: トースト「しばらく待ってから再試行してください (429)」。

---

## 6. デザイン共有用 TODO

- [ ] Summary diff ビジュアル (2 カラム diff) を Figma で再現。
- [ ] MindMap ノード/エッジスタイルのコンポーネント化 (React Flow node styles)。
- [ ] Advice カードのレスポンシブレイアウトチェック (モバイル: 1 カラム)。
- [ ] Icon set: phosphor icons を利用 (CheckCircle, Flame, ArrowElbowRightDown 等)。
- [ ] UI 仕様レビュー会 (Design + Frontend) でハイライト閾値・カラー定義を確定。

---

## 7. 参考リソース

- Figma: `Digital Note v1 / AI Insights Drawer` (デザインチーム作成予定)
- ライブラリ:
  - 差分表示: `diff-match-patch`, `react-diff-viewer`
  - Graph: `react-flow`, `dagre`, `elkjs`
  - カード: `shadcn/ui Card`, `Badge`, `Alert`
- AA スタイルガイド: Tailwind カラーパレット (Slate/Orange/Sky)

---

更新履歴  
- 2025-10-24: 初版作成 (Summary Diff + MindMap + Advice UI ビジュアル仕様)
